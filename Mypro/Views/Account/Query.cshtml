@model List<Mypro.Models.ContactMessage>
@{
    ViewBag.Title = "Query Management";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
<br />
<br />
<a href="javascript:history.back()" class="btn btn-light mb-3" style="font-size:20px; font-weight:bold;">←</a>

<h2>All Queries</h2>

<div id="queriesContainer" class="queries-container">
    @foreach (var q in Model)
    {
        <div class="query-card shadow-sm p-4 mb-3 rounded">
            <div class="query-header d-flex justify-content-between align-items-center mb-2">
                <div class="query-header-text">
                    <strong>@q.Name</strong> (<a href="mailto:@q.Email">@q.Email</a>)
                    <small>| @q.CreatedAt.ToString("dd/MM/yyyy HH:mm")</small>
                </div>
            </div>

            <p class="query-text mb-1"><strong>Subject:</strong> @q.Subject</p>
            <p class="query-text mb-2"><strong>Message:</strong> @q.Message</p>

            <div class="reply-section mt-3">
                <strong>Reply:</strong>
                @* <div class="current-reply mb-2">@(!string.IsNullOrEmpty(q.Reply) ? q.Reply : "No reply yet !")</div> *@
            <div class="current-reply mb-2">
                @Html.Raw(!string.IsNullOrEmpty(q.Reply)
                                ? $"<span style='color:blue; font-weight:bold;'>{q.Reply}</span>"
                                : "<span style='color:red; font-weight:bold;'>No reply yet!</span>")
            </div>


                <textarea class="form-control reply-text mb-2" placeholder="Type your reply..." rows="3"></textarea>
                <button class="btn btn-success send-reply" data-id="@q.Id">
                    <i class="bi bi-reply-fill"></i> Send Reply
                </button>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(function(){
            $(".send-reply").click(function(){
                var btn = $(this);
                var id = btn.data("id");
                var replyText = btn.closest(".reply-section").find(".reply-text").val();

                if(!replyText){
                    alert("Please enter a reply.");
                    return;
                }

                $.post("/Account/Reply", { id: id, reply: replyText }, function(res){
                    if(res.success){
                        btn.closest(".reply-section").find(".current-reply").html(res.reply);
                        btn.closest(".reply-section").find(".reply-text").val(""); 
                        alert(res.message);
                    } else {
                        alert(res.message);
                    }
                });
            });
        });
    </script>
}

<style>
    h2 {
        color: black;
    }

    body.theme-dark h2 {
        color: white !important;
    }

    /* Page title */
    .page-title {
        font-size: 28px;
        font-weight: 600;
        margin-bottom: 20px;
        color: black; /* default light theme text */
    }

    /* Container */
    .queries-container {
        display: flex;
        flex-direction: column;
    }

    /* Query Card */
    .query-card {
        border-left: 4px solid #4CAF50;
        background-color: #ffffff;
        transition: transform 0.2s, box-shadow 0.2s;
        color: black; /* default text color for light theme */
    }

        .query-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }

    .query-header small {
        font-size: 0.85rem;
    }

    /* Query text */
    .query-text {
        color: inherit; /* respects theme color */
    }

    /* Reply Section */
    .reply-section .current-reply {
        background-color: #f1f3f5;
        padding: 10px;
        border-radius: 6px;
        min-height: 40px;
        color: black; /* light theme default */
    }

    .reply-section textarea.reply-text {
        border: 1px solid #333;
        border-radius: 6px;
        color: black; /* light theme default */
        background-color: #fff;
    }

    .reply-section button.send-reply {
        background-color: #4CAF50;
        color: #fff;
        border: none;
        border-radius: 6px;
        padding: 6px 14px;
        cursor: pointer;
        transition: background 0.2s;
    }

        .reply-section button.send-reply:hover {
            background-color: #45a049;
        }

    /* Dark Theme */
    body.theme-dark .page-title,
    body.theme-dark .query-card,
    body.theme-dark .query-text,
    body.theme-dark .query-header-text,
    body.theme-dark .reply-section .current-reply,
    body.theme-dark .reply-section textarea.reply-text {
        color: white !important;
    }

    body.theme-dark .query-card {
        background-color: #2c2c2c;
        border-left-color: #66bb6a;
    }

    body.theme-dark .reply-section .current-reply {
        background-color: #444;
    }

    body.theme-dark .reply-section textarea.reply-text {
        background-color: #333;
        border: 1px solid #888;
    }
</style>
